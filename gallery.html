<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gallery | Gaurao Garden</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Markdown Parser for AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
            --primary-maroon: #7F1D1D;
            --primary-hover: #5e1414;
            --accent-gold: #D4AF37;
            --accent-gold-light: #FDE047;
            --bg-light: #FAFAF9;
            --text-dark: #1C1917;
            --text-gray: #57534E;
            --white: #FFFFFF;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, .serif { font-family: 'Playfair Display', serif; }

        /* --- Header / Nav --- */
        header {
            background-color: var(--white);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-maroon);
            text-decoration: none;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links { display: flex; gap: 30px; align-items: center; }

        .nav-links a {
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .nav-links a:hover, .nav-links a.active { color: var(--primary-maroon); }

        .btn-nav {
            background-color: var(--primary-maroon);
            color: white !important;
            padding: 10px 20px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .btn-nav:hover { background-color: var(--primary-hover); }

        .hamburger { display: none; cursor: pointer; font-size: 1.5rem; }

        /* --- Gallery Hero --- */
        .gallery-hero {
            height: 50vh;
            margin-top: 80px;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1559339352-11d035aa65de?ixlib=rb-1.2.1&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
        }

        .gallery-hero h1 {
            font-size: 3.5rem;
            margin-bottom: 15px;
        }

        /* --- Filters --- */
        .gallery-filters {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 60px 0 40px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: transparent;
            border: 1px solid #ddd;
            padding: 10px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Lato', sans-serif;
            font-weight: 600;
            color: var(--text-gray);
            transition: all 0.3s;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        .filter-btn:hover, .filter-btn.active {
            background-color: var(--primary-maroon);
            color: white;
            border-color: var(--primary-maroon);
        }

        /* --- Masonry Grid --- */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 80px;
        }

        .gallery-item {
            position: relative;
            height: 300px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            display: block;
        }

        .gallery-item:hover img {
            transform: scale(1.08);
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .gallery-item:hover .overlay {
            opacity: 1;
        }

        .overlay-icon {
            color: white;
            background: var(--primary-maroon);
            padding: 12px;
            border-radius: 50%;
            transform: translateY(20px);
            transition: transform 0.3s;
            display:flex;
            align-items:center;
            justify-content:center;
        }

        .gallery-item:hover .overlay-icon {
            transform: translateY(0);
        }

        /* --- Lightbox --- */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
            padding: 20px;
        }

        .lightbox.active {
            display: flex;
            opacity: 1;
        }

        .lightbox-content-wrapper {
            position: relative;
            max-width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lightbox-img {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .lightbox-close {
            position: absolute;
            top: -40px;
            right: -40px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            background: transparent;
            border: none;
        }

        .ai-pairing-btn {
            background: linear-gradient(135deg, var(--primary-maroon), #4a0f0f);
            color: white;
            border: 1px solid var(--accent-gold);
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            z-index: 2010;
        }

        .ai-pairing-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .ai-pairing-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
        }

        .ai-result-box {
            background: white;
            color: var(--text-dark);
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            margin-top: 20px;
            display: none;
            animation: slideUp 0.3s ease-out;
            max-height: 30vh;
            overflow-y: auto;
            border-left: 4px solid var(--accent-gold);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* loader spin utility (used for dynamic loader icon) */
        .spin {
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* --- AI Concierge Widget --- */
        .ai-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--accent-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1500;
            transition: transform 0.3s;
            color: #4a3800;
        }

        .ai-fab:hover { transform: scale(1.1) rotate(10deg); }

        .ai-chat-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            z-index: 1500;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #eee;
        }

        .ai-header {
            background: var(--primary-maroon);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #FAFAF9;
        }

        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            max-width: 85%;
        }

        .message.ai {
            background: #F3F4F6;
            color: var(--text-dark);
            border-top-left-radius: 0;
        }

        .message.user {
            background: var(--primary-maroon);
            color: white;
            margin-left: auto;
            border-top-right-radius: 0;
        }

        .ai-input-area {
            padding: 10px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            background: white;
        }

        .ai-input-area input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .ai-input-area button {
            background: var(--accent-gold);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            color: #4a3800;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .typing-indicator {
            font-style: italic;
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 5px;
            display: none;
        }

        /* --- Footer --- */
        footer {
            background-color: #000;
            color: #9CA3AF;
            padding: 60px 0 20px;
        }
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        .footer-col h4 { color: white; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .footer-col ul { list-style: none; }
        .footer-col ul li { margin-bottom: 10px; }
        .footer-col ul li a { color: #9CA3AF; text-decoration: none; transition: color 0.3s; }
        .footer-col ul li a:hover { color: var(--accent-gold); }

        @media (max-width: 1024px) {
            .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
        }

        @media (max-width: 768px) {
            .hamburger { display: block; }
            .nav-links { display: none; }
            .gallery-grid { grid-template-columns: 1fr; }
            .lightbox-img { max-width: 100%; }
            .ai-chat-window { width: 90%; right: 5%; bottom: 100px; }
        }
.logo-img {
    width: 100px;      /* adjust size */
    height: 90px;     /* keep square */
    object-fit: cover;
    margin-right: 1px;
}
.logo {
    display: flex;
    align-items: center;
    gap: 8px;
}

    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <img src="IMG_4649.PNG" alt="Logo" class="logo-img">
                GAURAV GARDEN
            </a>

            <div class="hamburger" id="hamburger" aria-label="Open menu" role="button" tabindex="0">
                <i data-lucide="menu"></i>
            </div>

            <nav class="nav-links" id="nav-links" aria-label="Primary navigation">
                <a href="index.html">Home</a>
                <a href="menu.html">Menu</a>
                <a href="events.html">Events</a>
                <a href="gallery.html" class="active">Gallery</a>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
                <a href="reservations.html" class="btn-nav">Book Table</a>
            </nav>
        </div>
    </header>

    <!-- Hero -->
    <section class="gallery-hero" role="img" aria-label="Restaurant hero image">
        <div class="container">
            <h1 class="serif">A Visual Journey</h1>
            <p style="font-size: 1.1rem; color: rgba(255,255,255,0.9);">Explore the moments, flavors, and ambience that define us.</p>
        </div>
    </section>

    <!-- Gallery Content -->
    <div class="container">
        <!-- Filters -->
        <div class="gallery-filters" role="toolbar" aria-label="Filter gallery">
            <button class="filter-btn active" data-filter="all">All Photos</button>
            <button class="filter-btn" data-filter="interior">Interior</button>
            <button class="filter-btn" data-filter="food">Food & Drinks</button>
            <button class="filter-btn" data-filter="events">Events</button>
        </div>

        <!-- Grid -->
        <div class="gallery-grid" id="gallery-grid">
            <!-- Items (kept original images/alt text) -->
            <div class="gallery-item" data-category="interior">
                <img src="https://images.unsplash.com/photo-1544148103-0773bf10d330?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="The Grand Main Hall">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="food">
                <img src="https://images.unsplash.com/photo-1533777857889-4be7c70b33f7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Pan-Seared Scallops with Truffle Pea Purée">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="events">
                <img src="https://images.unsplash.com/photo-1519671482502-9759101d4561?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Garden Wedding Reception Setup">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="food">
                <img src="https://images.unsplash.com/photo-1595295333158-4742f28fbd85?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Lobster Risotto with Saffron">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="interior">
                <img src="https://images.unsplash.com/photo-1556910103-1c02745a30bf?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Our Award-Winning Chefs in Action">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="food">
                <img src="https://images.unsplash.com/photo-1563729784474-d77dbb933a9e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Decadent Chocolate Hazelnut Dome">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="events">
                <img src="https://images.unsplash.com/photo-1519225421980-715cb0202128?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Private Banquet Hall Setup">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="food">
                <img src="https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Signature Craft Cocktails">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>

            <div class="gallery-item" data-category="interior">
                <img src="https://images.unsplash.com/photo-1577219491135-ce391730fb2c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Chef Plating the Signature Dish">
                <div class="overlay">
                    <div class="overlay-icon"><i data-lucide="zoom-in"></i></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="lightbox-content-wrapper">
            <button class="lightbox-close" id="lightbox-close" aria-label="Close full view">
                <i data-lucide="x"></i>
            </button>
            <img src="" alt="Full View" class="lightbox-img" id="lightbox-img">

            <!-- Gemini Integration: Sommelier Button -->
            <button class="ai-pairing-btn" id="ai-pairing-btn" style="display: none;" aria-live="polite">
                <i data-lucide="sparkles"></i> Ask AI Sommelier for Pairing
            </button>

            <!-- AI Result Box -->
            <div class="ai-result-box" id="ai-result-box" aria-live="polite">
                <h4 style="color: var(--primary-maroon); margin-bottom: 10px; font-family: 'Playfair Display', serif;">Chef's Notes & Pairing</h4>
                <div id="ai-result-text" style="font-size: 0.9rem;"></div>
            </div>
        </div>
    </div>

    <!-- AI Concierge Widget -->
    <div class="ai-fab" id="ai-fab" title="Plan your event with AI" role="button" tabindex="0">
        <i data-lucide="sparkles" size="28"></i>
    </div>

    <div class="ai-chat-window" id="ai-chat-window" aria-hidden="true">
        <div class="ai-header">
            <span style="font-weight: 700;">Gaurao Event Planner ✨</span>
            <i data-lucide="x" style="cursor: pointer;" id="ai-close-chat" role="button" tabindex="0"></i>
        </div>
        <div class="ai-messages" id="ai-messages">
            <div class="message ai">
                Hello! I'm your AI Event Concierge. Tell me about your dream event (e.g., "A jazz birthday party for 30 people") and I'll draft a plan for you!
            </div>
        </div>
        <div class="typing-indicator" id="typing-indicator">Gemini is thinking...</div>
        <div class="ai-input-area">
            <input type="text" id="ai-input" placeholder="Describe your event..." aria-label="Event description">
            <button id="ai-send-btn" aria-label="Send event request"><i data-lucide="send" size="18"></i></button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="logo" style="margin-bottom: 20px; color: white;">
                        <i data-lucide="flower-2"></i> GAURAO GARDEN
                    </div>
                    <p>The best dining experience for you and your family. We serve love on a plate with memories.</p>
                </div>

        <div class="container nav-container">
            <a href="index.html" class="logo"><i data-lucide="flower-2"></i> GAURAO GARDEN</a>
            <div class="hamburger"><i data-lucide="menu"></i></div>
            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="menu.html">Menu</a>
                <a href="events.html" class="active">Events</a>
                <a href="gallery.html">Gallery</a>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
                <a href="reservations.html" class="btn-nav">Book Table</a>
            </nav>
        </div>

                <div class="footer-col">
                    <h4>Contact Us</h4>
                    <ul>
                        <li><i data-lucide="map-pin" size="14" style="color: var(--accent-gold);"></i> 123 Culinary St, Taste City</li>
                        <li><i data-lucide="phone" size="14" style="color: var(--accent-gold);"></i> +1 (555) 123-4567</li>
                        <li><i data-lucide="mail" size="14" style="color: var(--accent-gold);"></i> info@gauraogarden.com</li>
                    </ul>
                </div>

                <div class="footer-col">
                    <h4>Opening Hours</h4>
                    <ul>
                        <li style="display: flex; justify-content: space-between;"><span>Mon - Fri:</span> <span style="color: white;">09:00 - 22:00</span></li>
                        <li style="display: flex; justify-content: space-between;"><span>Sat - Sun:</span> <span style="color: white;">10:00 - 23:00</span></li>
                    </ul>
                </div>
            </div>

            <div style="text-align: center; border-top: 1px solid #333; padding-top: 20px; font-size: 0.8rem;">
                &copy; 2025 Gaurao Garden. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script>
        // Render initial icons for static markup
        lucide.createIcons();

        // NOTE: Put your API key securely in server-side environment.
        // Leaving apiKey empty for safety. Replace through safe server-side proxy if needed.
        const apiKey = ""; // <-- DO NOT put secrets in client-side code for production

        document.addEventListener('DOMContentLoaded', () => {
            // DOM references
            const filterBtns = document.querySelectorAll('.filter-btn');
            const galleryItems = document.querySelectorAll('.gallery-item');
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxClose = document.getElementById('lightbox-close');
            const aiPairingBtn = document.getElementById('ai-pairing-btn');
            const aiResultBox = document.getElementById('ai-result-box');
            const aiResultText = document.getElementById('ai-result-text');

            const fab = document.getElementById('ai-fab');
            const chatWindow = document.getElementById('ai-chat-window');
            const closeChat = document.getElementById('ai-close-chat');
            const chatInput = document.getElementById('ai-input');
            const sendBtn = document.getElementById('ai-send-btn');
            const messagesContainer = document.getElementById('ai-messages');
            const typingIndicator = document.getElementById('typing-indicator');

            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('nav-links');

            // --- Filter Logic ---
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const filterValue = btn.getAttribute('data-filter');
                    galleryItems.forEach(item => {
                        if (filterValue === 'all' || item.getAttribute('data-category') === filterValue) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });

            // --- Lightbox & AI Sommelier Logic ---
            let currentAltText = "";

            galleryItems.forEach(item => {
                item.addEventListener('click', () => {
                    const img = item.querySelector('img');
                    const category = item.getAttribute('data-category');

                    lightboxImg.src = img.src;
                    lightboxImg.alt = img.alt || 'Gallery image';
                    currentAltText = img.alt || '';

                    lightbox.classList.add('active');
                    lightbox.setAttribute('aria-hidden', 'false');

                    // Reset AI box
                    aiResultBox.style.display = 'none';
                    aiResultText.innerHTML = "";

                    aiPairingBtn.disabled = false;
                    aiPairingBtn.innerHTML = '<i data-lucide="sparkles"></i> Ask AI Sommelier for Pairing';

                    // Only show Sommelier button for "food" category
                    if (category === 'food') {
                        aiPairingBtn.style.display = 'flex';
                    } else {
                        aiPairingBtn.style.display = 'none';
                    }

                    // Re-create icons because we changed innerHTML on dynamic button earlier
                    lucide.createIcons();
                });
            });

            const closeLightbox = () => {
                lightbox.classList.remove('active');
                lightbox.setAttribute('aria-hidden', 'true');
                lightboxImg.src = "";
            };

            lightboxClose.addEventListener('click', closeLightbox);
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) closeLightbox();
            });

            // Ai Sommelier Click Event
            aiPairingBtn.addEventListener('click', async () => {
                aiPairingBtn.disabled = true;
                aiPairingBtn.innerHTML = '<svg class="spin" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Analyzing Flavors...';

                // ensure any icons are re-created if needed
                lucide.createIcons();

                try {
                    const prompt = `I am at a fine dining restaurant looking at a dish described as "${currentAltText}". 
Please act as a Michelin-star sommelier.
1. Briefly describe the likely flavor profile of this dish (texture, key notes).
2. Recommend one Red and one White wine pairing that complements it perfectly.
Keep it concise (max 100 words).`;

                    // If you want to test locally without calling the real API, uncomment the stub below:
                    // const text = "Likely: creamy texture, buttery and with citrus brightness. Red: Pinot Noir. White: Chardonnay.";

                    const text = await callGeminiAPI(prompt); // will throw if apiKey is empty / invalid
                    aiResultText.innerHTML = marked.parse(text);
                    aiResultBox.style.display = 'block';
                    aiPairingBtn.innerHTML = '<i data-lucide="check"></i> Pairing Generated';
                    lucide.createIcons();
                } catch (err) {
                    console.error(err);
                    aiPairingBtn.innerHTML = 'Error. Try Again.';
                    aiPairingBtn.disabled = false;
                    // keep icons consistent
                    lucide.createIcons();
                }
            });

            // --- AI Concierge Widget Logic ---
            const addMessage = (text, sender) => {
                const div = document.createElement('div');
                div.className = `message ${sender}`;
                // Use marked for small markdown support
                div.innerHTML = marked.parse(text);
                messagesContainer.appendChild(div);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            };

            const handleChatSubmit = async () => {
                const userText = chatInput.value.trim();
                if (!userText) return;

                addMessage(userText, 'user');
                chatInput.value = '';

                typingIndicator.style.display = 'block';
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                try {
                    const systemContext = `You are the Senior Event Planner at Gaurao Garden, a luxury venue. 
The user wants to plan an event. Based on their input, create a mini proposal.

Include:
1. A creative Name for the event theme.
2. A suggested layout (Garden vs Banquet Hall).
3. A curated 3-item mini menu idea based on the theme.

Be elegant, welcoming, and concise.`;

                    const fullPrompt = `${systemContext}\n\nUser Request: ${userText}`;
                    const responseText = await callGeminiAPI(fullPrompt);

                    typingIndicator.style.display = 'none';
                    addMessage(responseText, 'ai');
                } catch (error) {
                    typingIndicator.style.display = 'none';
                    addMessage("I apologize, I'm having trouble connecting to the reservation system right now. Please try again.", 'ai');
                    console.error(error);
                }
            };

            sendBtn.addEventListener('click', handleChatSubmit);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleChatSubmit();
            });

            // Toggle Chat
            fab.addEventListener('click', () => {
                chatWindow.style.display = 'flex';
                chatWindow.setAttribute('aria-hidden', 'false');
                fab.style.display = 'none';
            });

            closeChat.addEventListener('click', () => {
                chatWindow.style.display = 'none';
                chatWindow.setAttribute('aria-hidden', 'true');
                fab.style.display = 'flex';
            });

            // Hamburger Menu behavior
            hamburger.addEventListener('click', () => {
                const isHidden = navLinks.style.display === 'none' || navLinks.style.display === '';
                if (isHidden) {
                    navLinks.style.display = 'flex';
                    navLinks.style.flexDirection = 'column';
                    navLinks.style.position = 'absolute';
                    navLinks.style.top = '80px';
                    navLinks.style.left = '0';
                    navLinks.style.width = '100%';
                    navLinks.style.background = 'white';
                    navLinks.style.padding = '20px';
                    navLinks.style.boxShadow = '0 5px 5px rgba(0,0,0,0.1)';
                } else {
                    navLinks.style.display = 'none';
                }
            });

            // keyboard accessibility for hamburger
            hamburger.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') hamburger.click();
            });

            // Re-create icons to ensure any dynamically generated icon markup renders
            lucide.createIcons();
        });

        // --- GEMINI API FUNCTION ---
        async function callGeminiAPI(prompt) {
            // CAUTION: API key should never be exposed in client-side code for production.
            // Use a server-side proxy or backend to keep secrets safe.
            if (!apiKey) {
                // for safety/fallback: return a helpful stub so UI doesn't break during local dev
                return `**(Demo response)**\n\nLikely flavor profile: rich, creamy texture with bright citrus notes and mild umami.\n\n**Red:** Pinot Noir — light-bodied with red fruit and subtle earth that won't overpower.\n**White:** Chardonnay (unoaked or lightly oaked) — gives a buttery roundness and crisp finish.`;
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                content: [{
                    type: "text",
                    text: prompt
                }]
            };

            // keep headers minimal and standard
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();

            // safe access with fallback
            // The exact response shape might differ by API version; adapt as necessary.
            if (data?.candidates?.[0]?.content?.[0]?.text) {
                return data.candidates[0].content[0].text;
            }
            if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
                return data.candidates[0].content.parts[0].text;
            }
            // fallback: stringify a helpful message
            return JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>
